## 编译所做的事情：

对一个cpp进行**预处理**，将**头文件**加载进来，并且将各种**#define信息**代入，生成一个独立的编译单元，然后进行编译生成obj文件，一个cpp对应一个obj文件。

编译过程，先生成**汇编语言**，再生成**机器语言**（即汇编指令对应的机器码，cpu认识的指令）



过程

预编译g++ -E为main.i

编译g++ -S 为main.s

汇编g++ -C为main.o 

链接



### **Cpp的静态链接和动态链接**

在C++中，静态链接和动态链接是两种不同的链接方式，用于将代码模块组合成可执行程序。

#### 静态链接

在编译时直接将静态库(.lib 或者 .a 文件，取决于操作系统)中的代码复制到最终的可执行文件中。这意味着如果多个程序使用同一个静态库，该库的内容会在每个使用它的程序中复制。

#### 动态链接

在编译时不将库的内容直接包含到可执行文件中，而是在程序运行时由操作系统动态加载所需的库。如果多个程序使用同一个动态库，则该库在磁盘上只有一个副本，由所有使用它的程序共享。



静态链接示例代码（以Linux下的GCC编译器为例）：

g++ myprogram.cpp -lmylibrary -L/path/to/library/static -static

动态链接示例代码（以Linux下的GCC编译器为例）：

g++ myprogram.cpp -lmylibrary -L/path/to/library/dynamic

在这两个例子中，-lmylibrary 表示链接名为 mylibrary 的库，-L/path/to/library 指定了库文件所在的目录。-static 选项用于强制静态链接。

在实际应用中，通常首选动态链接，因为它可以减少程序的大小，并允许库的更新和共享。静态链接在某些情况下更可靠，因为它不需要库文件的存在。





#### **链接重复定义**

因为在头文件中有

\#ifndef XXX

\#define XXX

...

\#endif

所以在编译的时候，**头文件不会被重复包含**，不会出现重定义的问题。                                                         

但是如果头文件中有函数的定义，那么不同cpp文件都包含这个头文件，在汇编成.o文件后，不同的.o文件中都含有头文件中函数的定义，链接阶段就会出现重定义的问题。

如果出现这种错误，找到提示信息中函数所在的头文件，在头文件中保留函数的声明，把函数的实现都删掉，放在一个单独的cpp文件中。

头文件中一定要有函数的声明，否则编译器在类型检查的时候看不见函数的名字。