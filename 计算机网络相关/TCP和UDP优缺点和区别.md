TCP UDP

TCP和UDP是两种不同的**传输层**协议，用于在计算机网络中实现端到端的通信。

TCP（传输控制协议）：

 TCP是面向连接的协议。在数据传输之前，必须先建立连接。连接的建立和断开是可靠的，并且在数据传输过程中会进行**错误检测和重传**。

可靠性： TCP提供可靠的数据传输。它使用序号、确认和超时机制来确保数据的可靠性。如果数据包在传输过程中丢失或损坏，TCP会自动进行重传。

流式传输： TCP是面向字节流的，数据被看作是**一连串的字节**而不是分割成独立的数据包。TCP会负责将这个字节流分割成合适大小的数据包。

拥塞控制： TCP具有拥塞控制机制，通过调整发送数据的速率来适应网络的状况，从而防止网络拥塞。

应用场景： 适用于需要可靠数据传输和顺序传送的应用，如文件传输、电子邮件、远程登录等。





UDP（用户数据报协议）：

UDP是无连接的协议，通信双方在传输数据之前**不需要建立连接**。因此，UDP的**开销较小**。

不可靠性： UDP不提供可靠的数据传输。它不进行错误检测和重传，丢失或损坏的数据包将不会被处理。

面向数据报： UDP是面向数据报的，每个UDP数据包都是独立的，独立处理，没有顺序要求。

流式传输： UDP也是面向字节流的，但相对于TCP来说，UDP没有建立连接的阶段，数据包的边界更为明显。

低延迟： 由于不需要建立连接和进行**可靠性的处理**，UDP通常具有较低的传输延迟。

应用场景： 适用于对传输速度要求较高、对数据完整性要求较低的应用，如实时音视频传输、在线游戏等。



选择TCP还是UDP取决于应用的特性和要求。如果需要**可靠**的数据传输和数据的**完整性**，通常选择TCP。如果对延迟敏感且可以容忍一些**数据丢失**的情况，可以选择UDP。





TCP 三次握手建立连接

建立连接全过程

**1、客户端**发送 **SYN报文** 给服务器，说明客户端**请求建立连接** 

**2、服务端**收到客户端发的 SYN报文 ，并回复 SYN**+ACK报文** 给客户端（同意建立连接）

3、**客户端**收到服务端的 SYN+ACK报文 后，回复 **ACK报文** 给服务端（表示客户端收到了服务端发的同意报文） 服务端收到客户端的 ACK报文 ，**连接已建立**，可以数据传输。







TCP 四次挥手释放连接

释放连接全过程

**1、客户端**发送 **FIN 报文** 给服务器，说明客户端不必发送数据给服务器了（请求释放从客户端到服务器的连接）； 

**2、服务端**接收到客户端发的 FIN报文 ，并回复 **ACK报文** 给客户端（同意释放从客户端到服务器的连接）； 客户端收到服务端回复的 ACK报文 ，此时从客户端到服务器的连接已释放（但服务端到客户端的连接还未释放，并且客户端还可以接收数据）； **服务端**继续发送之前没发完的数据给客户端；

3、服务端发送 **FIN+ACK 报文** 给客户端，说明服务端发送完了数据（请求释放从服务端到客户端的连接，就算没收到客户端的回复，过段时间也会自动释放）；

4、**客户端**收到服务端的 FIN+ACK报文 ，并回复 **ACK报文** 给服务端（同意释放从服务端到客户端的连接）； 服务端收到客户端的 ACK报文 后，释放从服务端到客户端的连接。





TCP 为什么要进行三次握手 

因为信道不可靠，而 TCP 想在不可靠信道上建立可靠地传输，那么**三次通信是理论上的最小值**（而 UDP 则不需建立可靠传输，因此 UDP 不需要三次握手）



TCP 建立连接为什么是三次握手

因为双方**都需要确认对方收到了自己发送的序列号**，确认过程最少要进行三次通信。



 TCP 为什么是三次握手，而不是两次或四次

为了防止**已失效的连接请求报文段**突然又传送到了服务端，因而产生错误。







TCP 为什么要进行四次挥手？ / 为什么 TCP 建立连接需要三次，而释放连接则需要四次？

因为 **TCP 是全双工模式**，客户端请求关闭连接后，**客户端向服务端**的连接关闭（一二次挥手），服务端**继续传输**之前没传完的数据给客户端（数据传输），**服务端向客户端**的连接关闭（三四次挥手）。所以 TCP 释放连接时服务器的 ACK 报文 和 FIN 报文 是**分开发送**的（中间隔着数据传输），而 TCP 建立连接时服务器的 ACK 和 SYN 报文 是**一起发送**的（第二次握手），所以 TCP 建立连接需要三次，而释放连接则需要四次。





为什么 TCP 连接时可以 ACK报文 和 SYN 报文 一起发送，而释放时则 ACK 报文 和 FIN 报文 分开发送呢？（ACK 报文 和 FIN 报文 分开是指第二次和第三次挥手）

因为客户端请求释放时，服务器**可能还有数据**需要传输给客户端，因此服务端要**先响应**客户端 FIN报文 请求（服务端发送 ACK报文 ），然后数据传输，**传输完成后**，服务端再提出 FIN报文 请求（服务端发送 FIN报文 ）；而连接时则没有中间的数据传输，因此连接时可以 ACK 报文 和 SYN 报文 一起发送。



为什么客户端释放最后需要 TIME-WAIT 等待 2MSL 呢？

为了保证**客户端发送的最后一个 ACK 报文能够到达服务端**。若未成功到达，则服务端**超时重传** FIN+ACK 报文段，客户端再重传 ACK，并**重新计时**。 防止已失效的连接请求报文段出现在本连接中。TIME-WAIT 持续 2MSL 可使本连接持续的时间内所产生的**所有报文段都从网络中消失**，这样可使下次连接中**不会出现旧的**连接报文段。



